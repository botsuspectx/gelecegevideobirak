<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Geleceğe Mesaj</title>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <style>
    /* Mevcut tüm CSS (kapsüller, hover menü, form, yorum alanı vs.) */
    body {
      background: linear-gradient(135deg, #dbeafe, #e0f2fe);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      overflow-x: hidden;
      position: relative;
    }
    .background-capsules { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
    .capsule { position: absolute; width: 40px; height: 16px; border-radius: 20px; background: rgba(59, 130, 246, 0.3); animation: float linear infinite; }
    @keyframes float {
      0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
      10% { opacity: 1; }
      100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
    }
    .hover-menu-container {
      display: flex; gap: 12px; padding: 20px; justify-content: center; flex-wrap: wrap;
    }
    .hover-btn {
      background-color: #2563eb; color: white; padding: 12px 20px; border-radius: 9999px; cursor: pointer; font-weight: bold;
      transition: background 0.3s ease; position: relative;
    }
    .hover-btn:hover { background-color: #1d4ed8; }
    .hover-content {
      position: absolute; top: 50px; background-color: white; color: #1e293b; border-radius: 12px;
      padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: none; width: 250px; z-index: 999;
    }
    .hover-content ul { list-style: none; padding: 0; margin: 0; }
    .hover-content li { margin-bottom: 8px; font-size: 14px; }

    .form-container {
      background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      max-width: 500px; width: 100%; margin: 20px auto; position: relative; z-index: 1;
    }
    .form-container::before {
      content: ""; position: absolute; top: -10px; right: -10px; bottom: -10px; left: -10px;
      z-index: -1; background: linear-gradient(135deg, #60a5fa, #3b82f6);
      border-radius: 25px; filter: blur(20px); opacity: 0.2;
    }
    input, textarea {
      width: 100%; padding: 12px; margin-top: 12px; border: 1px solid #cbd5e1; border-radius: 10px; font-size: 14px;
    }
    button {
      margin-top: 20px; width: 100%; padding: 12px; background-color: #2563eb;
      color: white; font-size: 16px; font-weight: bold; border: none; border-radius: 10px; cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover:not(:disabled) { background-color: #1d4ed8; }
    button:disabled { background-color: #94a3b8; cursor: not-allowed; }
    #loadingText { display: none; text-align: center; margin-top: 15px; font-style: italic; color: #475569; animation: pulse 1.5s infinite; }
    @keyframes pulse { 0% {opacity: 0.3;} 50% {opacity: 1;} 100% {opacity: 0.3;} }

    .yorumlar-wrapper {
      max-width: 600px; margin: 40px auto; background: white; border-radius: 15px; padding: 25px; box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    .yorumlar-wrapper h3 { margin-bottom: 15px; color: #1e3a8a; }
    .yorumlar-wrapper form input, .yorumlar-wrapper form textarea {
      width: 100%; margin-top: 10px; padding: 10px; border: 1px solid #ccc; border-radius: 8px;
    }
    .yorumlar-wrapper .yorum {
      border-top: 1px solid #ddd; margin-top: 20px; padding-top: 15px;
    }
    .yorumlar-wrapper .yorum small {
      color: gray; font-size: 13px;
    }
    @media (max-width: 600px) {
  .form-container, .yorumlar-wrapper {
    width: 90%;
    padding: 20px;
  }

  .hover-menu-container {
    flex-direction: column;
    align-items: center;
  }

  .hover-btn {
    width: 90%;
    text-align: center;
    margin-bottom: 10px;
  }

  .hover-content {
    top: 45px;
    width: 90vw;
    left: 0 !important;
    right: 0;
    margin: auto;
  }

  input, textarea, button {
    font-size: 16px;
  }
}
.email-verification {
  display: flex;
  gap: 10px;
  margin-top: 12px;
}
.email-verification input[type="email"] {
  flex: 7;
  padding: 12px;
  font-size: 14px;
  border: 1px solid #cbd5e1;
  border-radius: 10px;
}
.email-verification button {
  flex: 3;
  padding: 12px;
  font-size: 14px;
  font-weight: bold;
  border: none;
  border-radius: 10px;
  background-color: #2563eb;
  color: white;
  cursor: pointer;
  transition: background-color 0.3s ease;
}
.email-verification button:disabled {
  background-color: #a5b4fc;
  cursor: not-allowed;
}
.code-verification {
  margin-top: 10px;
}
.code-verification input {
  width: 100%;
  padding: 12px;
  font-size: 14px;
  border: 1px solid #cbd5e1;
  border-radius: 10px;
}



  </style>
</head>
<body>

  <div class="background-capsules" id="capsuleContainer"></div>

  <div class="hover-menu-container">
    <div class="hover-btn" data-content="how">📋 Nasıl Çalışır?</div>
    <div class="hover-btn" data-content="why">🔒 Neden Biz?</div>
    <div class="hover-btn" data-content="faq">❓ SSS</div>

    <div class="hover-content" id="how">
      <ul>
        <li>1️⃣ Videonu yükle ve teslim tarihini belirle</li>
        <li>2️⃣ Notunu ekle</li>
        <li>3️⃣ Belirlediğin tarihte gönderilsin</li>
      </ul>
    </div>
    <div class="hover-content" id="why">
      <ul>
        <li>🔐 Google Drive ile güvenli saklama</li>
        <li>📅 Zamanlanmış otomatik teslim</li>
        <li>🧘 Kolay ve hızlı kullanım</li>
      </ul>
    </div>
<div class="hover-content" id="faq">
  <ul>
    <li><strong>S:</strong> Video ne kadar saklanır?</li>
    <li><strong>C:</strong> Belirlenen teslim tarihine kadar.</li>

    <li><strong>S:</strong> Video boyut sınırı var mı?</li>
    <li><strong>C:</strong> Evet. 5 MB'a kadar ücretsizdir. Üzerindeki boyutlar için ücret alınır.</li>

    <li><strong>S:</strong> Mesajlarımı kimler görebilir?</li>
    <li><strong>C:</strong> Sadece belirttiğiniz alıcılar, belirtilen tarihte erişebilir.</li>

    <li><strong>S:</strong> Teslim tarihinden önce videoya erişebilir miyim?</li>
    <li><strong>C:</strong> Hayır, güvenlik için sadece belirlenen tarihte erişim açılır.</li>
  </ul>
</div>

  </div>

  <div class="form-container">
    <h2>🔐 Güvenle Geleceğe Mesaj Gönder</h2>
    <form id="messageForm" enctype="multipart/form-data">
      <input type="text" name="fullname" placeholder="İsim Soyisim" required>
<div class="email-verification">
  <input type="email" id="email" name="email" placeholder="E-posta" required>
  <button type="button" id="sendCodeBtn" disabled>Kod Gönder</button>
</div>
<div class="code-verification">
  <input type="text" id="verificationCode" placeholder="Kodu giriniz" disabled>
  <small id="timerText" style="color: gray;"></small>
</div>


      <input type="tel" name="phone" placeholder="Telefon (isteğe bağlı)">
      <textarea name="note" placeholder="Notun:" rows="4" required></textarea>
      <input type="date" name="deliveryDate" required>
      <input type="file" name="video" accept="video/*" required>
      <button type="submit" id="submitButton">Gönder</button>
      <div id="loadingText">⏳ Video yükleniyor, lütfen bekleyiniz...</div>
    </form>
  </div>

  <div class="yorumlar-wrapper">
    <h3>🗨️ Yorum Yaz</h3>
    <form id="yorumForm">
      <input type="text" name="name" placeholder="Adınız" required />
      <input type="email" name="email" placeholder="E-posta" required />
      <textarea name="comment" placeholder="Yorumunuz" required></textarea>
      <label><input type="checkbox" name="showName" checked /> İsmin görünsün</label>
      <div class="g-recaptcha" data-sitekey="6Lejk2UrAAAAAG50c7Q9JOKfQ-QlnUOwTZ0tiBNH" style="margin-top: 10px;"></div>
      <button type="submit">Yorumu Gönder</button>
    </form>
    <div id="yorumlarListesi"></div>
  </div>

  <footer style="text-align: center; margin-top: 40px; font-size: 14px; color: #475569;">
  <a href="kvkk.html" style="margin-right: 15px; color: #2563eb; text-decoration: none;">KVKK Aydınlatma Metni</a>
  <a href="kullanim-kosullari.html" style="color: #2563eb; text-decoration: none;">Kullanım Koşulları</a>
</footer>


  <script>
    const container = document.getElementById("capsuleContainer");
    for (let i = 0; i < 40; i++) {
      const capsule = document.createElement("div");
      capsule.classList.add("capsule");
      capsule.style.left = Math.random() * 100 + "vw";
      capsule.style.top = Math.random() * 100 + "vh";
      capsule.style.backgroundColor = `rgba(59, 130, 246, ${Math.random() * 0.4 + 0.1})`;
      capsule.style.animationDuration = (Math.random() * 20 + 10) + "s";
      capsule.style.animationDelay = (Math.random() * 10) + "s";
      container.appendChild(capsule);
    }

    const buttons = document.querySelectorAll('.hover-btn');
    const contents = document.querySelectorAll('.hover-content');
    buttons.forEach(btn => {
      btn.addEventListener('mouseenter', () => {
        contents.forEach(content => content.style.display = 'none');
        const target = document.getElementById(btn.dataset.content);
        if (target) target.style.display = 'block';
      });
    });
    document.addEventListener('mousemove', (e) => {
      const isInside = [...buttons, ...contents].some(el => el.contains(e.target));
      if (!isInside) contents.forEach(c => c.style.display = 'none');
    });

    const form = document.getElementById("messageForm");
    const loadingText = document.getElementById("loadingText");
    const submitButton = document.getElementById("submitButton");
    form.addEventListener("submit", async function (e) {
      e.preventDefault();
      if (!emailVerified) {
  alert("Lütfen e-posta adresinize gelen doğrulama kodunu girin.");
  return;
}

      const formData = new FormData(form);
      submitButton.disabled = true;
      submitButton.textContent = "Gönderiliyor...";
      loadingText.style.display = "block";
      try {
        const response = await fetch("/submit", { method: "POST", body: formData });
        const result = await response.json();
        if (result.success) {
          localStorage.setItem("fullname", form.fullname.value);
          localStorage.setItem("email", form.email.value);
          localStorage.setItem("phone", form.phone.value);
          localStorage.setItem("note", form.note.value);
          localStorage.setItem("deliveryDate", form.deliveryDate.value);
          localStorage.setItem("sizeMB", result.sizeMB);
          localStorage.setItem("price", result.price);
          localStorage.setItem("tempFilename", result.tempFilename);
          window.location.href = "preview.html";
        } else {
          alert("❌ Video yüklenemedi:\n" + result.error);
        }
      } catch (err) {
        alert("Sunucuya ulaşılamadı.");
      } finally {
        submitButton.disabled = false;
        submitButton.textContent = "Gönder";
        loadingText.style.display = "none";
      }
    });

    const yorumForm = document.getElementById("yorumForm");
yorumForm.addEventListener("submit", async function (e) {
  e.preventDefault();
  const formData = new FormData(yorumForm);
  const data = Object.fromEntries(formData.entries());
  data.showName = formData.has("showName");

  const token = grecaptcha.getResponse();
  if (!token) {
    alert("Lütfen reCAPTCHA doğrulamasını tamamlayın.");
    return;
  }
  data["g-recaptcha-response"] = token;

  try {
    const res = await fetch("/yorum-ekle", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const result = await res.json();
    if (result.success) {
      yorumForm.reset();
      grecaptcha.reset(); // captcha sıfırlama
      yorumlariGetir();
    } else {
      alert("Yorum eklenemedi: " + result.message);
    }
  } catch (err) {
    alert("Sunucu hatası.");
  }
});


    async function yorumlariGetir() {
      try {
        const res = await fetch("/yorumlar");
        const yorumlar = await res.json();
        const liste = document.getElementById("yorumlarListesi");
        liste.innerHTML = "";
        yorumlar.reverse().forEach(y => {
          const yorum = document.createElement("div");
          yorum.classList.add("yorum");
          yorum.innerHTML = `
            <p>${y.comment}</p>
            <small>${y.showName ? y.name : "Anonim"} – ${new Date(y.timestamp).toLocaleString("tr-TR")}</small>
          `;
          liste.appendChild(yorum);
        });
      } catch (err) {
        console.error("Yorumlar alınamadı:", err);
      }
    }

    window.addEventListener("DOMContentLoaded", yorumlariGetir);

    let sentCode = "";
let emailVerified = false;
let timerInterval;

document.getElementById("sendCodeBtn").addEventListener("click", async () => {
  const email = document.getElementById("email").value;
  if (!email.includes("@")) return alert("Lütfen geçerli bir e-posta girin.");

  document.getElementById("sendCodeBtn").disabled = true;
  document.getElementById("sendCodeBtn").textContent = "Gönderildi";
  document.getElementById("timerText").style.display = "inline";

  try {
    const res = await fetch("/email-dogrula", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email })
    });
    const result = await res.json();
    if (result.success) {
      sentCode = result.code;
      emailVerified = false;
      document.getElementById("verificationCode").disabled = false;
      startCountdown(60);
    } else {
      alert("Kod gönderilemedi.");
      resetCodeButton();
    }
  } catch {
    alert("Sunucu hatası");
    resetCodeButton();
  }
});

function resetCodeButton() {
  document.getElementById("sendCodeBtn").disabled = false;
  document.getElementById("sendCodeBtn").textContent = "Kod Gönder";
  document.getElementById("timerText").style.display = "none";
  clearInterval(timerInterval);
}

function startCountdown(seconds) {
  let remaining = seconds;
  timerInterval = setInterval(() => {
    if (remaining <= 0) {
      resetCodeButton();
      return;
    }
    document.getElementById("timerText").textContent = `Yeniden kod gönderilebilir: ${remaining} sn`;
    remaining--;
  }, 1000);
}
    document.getElementById("email").addEventListener("input", function () {
  const emailValue = this.value.trim();
  document.getElementById("sendCodeBtn").disabled = emailValue === "";
});


document.getElementById("verificationCode").addEventListener("input", function () {
  if (this.value === sentCode) {
    emailVerified = true;
    this.style.borderColor = "green";
  } else {
    emailVerified = false;
    this.style.borderColor = "red";
  }
});

    
  </script>
</body>
</html>
